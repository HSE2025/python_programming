---
marp: true
header: 
footer: 
title: "Неделя 11"
paginate: true
class: normal
theme: default
size: 16:9
style: |
  pre {
    overflow: auto;
  }
---


# Неделя 11: Работа с CSV и контроль версий
---
### Чистые тексты:
- контекстный поиск по корпусу,
- морфологический поиск по корпусу,

### Метаданные: 
- сопоставление текстов разных авторов или разных поэтических книг,
- хронологический поиск,

### Разметка и/или дополнительные библиотеки
- семантический анализ

---

![](https://cdn.markslides.ai/users/2662/images/Xyfqyd0AXNt5JNQcDvENJ)

---

![](https://cdn.markslides.ai/users/2662/images/R6n1vuz1N7htCmwqpVFun)

---

![](https://cdn.markslides.ai/users/2662/images/WMa47Bl5llonixqMUXWSt)

---

![](https://cdn.markslides.ai/users/2662/images/pkgKgCskloHJa-zXmMof_)

---

![](https://cdn.markslides.ai/users/2662/images/hoKwWDgmzkVO1TyBkK5m-)

---

![](https://cdn.markslides.ai/users/2662/images/-0UTCUTvzi6MHp6Za7IM4)

---

![](https://cdn.markslides.ai/users/2662/images/jaoKulFsKhN-Fqf55BIDP)

---

![](https://cdn.markslides.ai/users/2662/images/kY4YBYWkdJup42EgU-GDO)

---

![](https://cdn.markslides.ai/users/2662/images/nOWZGV9JfGg2uzUU1fLEh)

---

![](https://cdn.markslides.ai/users/2662/images/C5GS5HvBM2Q2DcjCOMZDY)

---

![](https://cdn.markslides.ai/users/2662/images/V_SeFn2Ok_eL8HlwP_CkL)

---

![](https://cdn.markslides.ai/users/2662/images/qhyflTXnqGoHyB1SdnZa9)

---
**Операции с CSV-файлами** - чтение, запись, обработка

**Плюс важные инструменты:**
- Область видимости переменных (локальные vs глобальные) - естественно появляется в CSV-функциях
- Основы GitHub - контроль версий для вашего проекта

---

## **CSV = Comma-Separated Values (Значения, разделённые запятыми)**

Универсальный формат для структурированных данных:
- Метаданные о текстах (автор, год, жанр)
- Результаты анализа (количество слов, TTR, статистика)
- Данные из таблиц (Excel, Google Sheets)
- Экспорт из баз данных

**Для вашего проекта:**
- `data/metadata.csv` - информация о текстах корпуса
- `results/statistics.csv` - результаты анализа

---

## Структура CSV: Основы

```
filename,title,author,year
text_1.txt,Евгений Онегин,Пушкин,1833
text_2.txt,Война и мир,Толстой,1869
text_3.txt,Идиот,Достоевский,1869
```

**Анатомия:**
- **Строка 1** = Заголовок (имена столбцов)
- **Строки 2+** = Строки данных
- **Разделитель** = Запятая (`,`)
- **Каждая строка** = Одна запись

---

## CSV как данные Python

**Что мы хотим получить:**

```python
data = [
    {'filename': 'text_1.txt', 'title': 'Евгений Онегин',
     'author': 'Пушкин', 'year': '1833'},
    {'filename': 'text_2.txt', 'title': 'Война и мир',
     'author': 'Толстой', 'year': '1869'},
    {'filename': 'text_3.txt', 'title': 'Идиот',
     'author': 'Достоевский', 'year': '1869'}
]
```

**Список словарей**: с ним проще всего работать!

---

## Чтение CSV: Шаг за шагом

**Цель:** Преобразовать CSV-файл → список словарей

**Алгоритм:**
1. Прочитать все строки из файла
2. Первая строка → заголовки (имена столбцов)
3. Остальные строки → строки данных
4. Для каждой строки:
   - Разделить по запятой
   - Создать словарь: {заголовок: значение}
   - Добавить в список результатов

---

## Практическая задача #1: Прочитать CSV и отфильтровать строки, где год > 1860

```python
# metadata.csv:
# filename,author,year
# text_1.txt,Пушкин,1833
# text_2.txt,Толстой,1869
# text_3.txt,Достоевский,1866

data = read_csv_file('metadata.csv')

# Фильтр для года > 1860
modern = []
for row in data:
    if int(row['year']) > 1860:
        modern.append(row)

print(modern)
# [{'filename': 'text_2.txt', 'author': 'Толстой', 'year': '1869'},
#  {'filename': 'text_3.txt', 'author': 'Достоевский', 'year': '1866'}]
```

---

## Запись CSV: Обратный процесс

**Цель:** Преобразовать список словарей → CSV-файл

**Алгоритм:**
1. Извлечь заголовки из первого словаря
2. Записать строку заголовка
3. Для каждого словаря:
   - Извлечь значения в порядке заголовков
   - Объединить запятыми
   - Записать строку

---

## Область видимости: Почему это важно

**Проблема, с которой вы столкнётесь:**

```python
header = ['name', 'age']  # Глобальная переменная

def read_csv_file(filepath):
    header = lines[0].strip().split(',')  # Локальная переменная
    return data

# После выполнения функции:
print(header)  # Что это выведет?
```

**Ответ:** `['name', 'age']` - без изменений!

**Почему?** Локальная vs глобальная область видимости

---

## Глобальная область видимости

**Глобальные переменные** - определены вне функций

```python
# Это ГЛОБАЛЬНЫЕ
filename = 'metadata.csv'
total_files = 0

def process_file():
    print(filename)  # Можно ЧИТАТЬ глобальные
    print(total_files)  # Можно ЧИТАТЬ глобальные

process_file()
# Выведет: metadata.csv
#         0
```

Функции могут **читать** глобальные переменные

---

## Локальная область видимости

**Локальные переменные** - определены внутри функций

```python
def calculate_stats():
    # Это ЛОКАЛЬНЫЕ (существуют только в функции)
    word_count = 100
    ttr = 0.75

    return word_count

result = calculate_stats()  # 100

# Попытка обратиться к локальной переменной:
print(word_count)  # ❌ NameError: name 'word_count' is not defined
```

Нельзя обращаться к локальным переменным вне функции

---

## Проблема затенения

```python
count = 0  # Глобальная

def process_text():
    count = 5  # Создаёт НОВУЮ локальную переменную!
    print(f"Внутри функции: {count}")  # 5

process_text()
print(f"Вне функции: {count}")  # Всё ещё 0!
```

**Что произошло?**
- `count = 5` создаёт **локальную** переменную
- Затеняет (скрывает) глобальную `count`
- Глобальная `count` не изменилась

---

## Решение 1: Возвращаемые значения

**Лучшая практика:** Не изменять глобальные, возвращать значения

```python
count = 0  # Глобальная

def process_text():
    local_count = 5
    return local_count

count = process_text()  # Обновить глобальную возвращаемым значением
print(count)  # 5
```

**Правило:** Используйте возвращаемые значения, не модификацию глобальных

---

## Решение 2: Ключевое слово global

**Когда вы ДОЛЖНЫ изменить глобальную:**

```python
count = 0  # Глобальная

def process_text():
    global count  # Сказать Python: использовать глобальную
    count = 5

process_text()
print(count)  # 5
```

**Используйте экономно!** Обычно лучше возвращать значения

---

## Область видимости в CSV-функциях

```python
def read_csv_file(filepath):
    # Все эти ЛОКАЛЬНЫЕ
    lines = f.readlines()
    header = lines[0].strip().split(',')
    data = []

    # Они НЕ существуют вне функции
    return data

# Это даст ошибку:
# print(header)  # NameError

# Вместо этого:
result = read_csv_file('file.csv')  # Получить возвращённое значение
```

**Принцип проектирования:** Каждая функция самодостаточна

---

## Практика: Отладка области видимости

**Что здесь не так?**

```python
def count_words(text):
    words = text.split()
    count = len(words)
    # Нет return!

result = count_words("Во глубине сибирских руд")
print(count)  # Что произойдёт?
```

**Ошибки:**
1. `count` локальная - не существует снаружи
2. Функция ничего не возвращает - result равен None

---

## Исправленная версия

```python
def count_words(text):
    """Подсчитать слова в тексте."""
    words = text.split()
    count = len(words)
    return count  # ✅ Вернуть значение

result = count_words("Привет мир")
print(result)  # 2
```

**Правило:** Всегда возвращайте то, что нужно вне функции

---

## Введение в GitHub: Зачем нужен контроль версий?

- `project_final.py`
- `project_final_v2.py`
- `project_REALLY_final.py`
- `project_final_fixed_for_real.py`

**Git/GitHub решает это:**
- Отслеживание всех изменений
- Просмотр истории
- Простое сотрудничество
- Резервное копирование в облаке

---

## Git vs GitHub: В чём разница?

**Git** = Программа контроля версий (работает на вашем компьютере)
**GitHub** = Облачная платформа для хостинга Git-репозиториев

**Аналогия:**
- Git = Microsoft Word (программа)
- GitHub = Google Drive (облачное хранилище)

**Сегодня:** Фокус на основах GitHub (упрощённый рабочий процесс)

---

## Настройка GitHub: Шаг 1

**Создать аккаунт GitHub:**

1. Перейти на https://github.com
2. Нажать "Sign up"
3. Выбрать имя пользователя
4. Ввести email
5. Создать пароль
6. Подтвердить email

**Готово!** У вас есть аккаунт GitHub

---

## Настройка GitHub: Шаг 2

**Создать репозиторий:**

1. Нажать зелёную кнопку "New" (вверху слева)
2. Имя репозитория: `python-dh-project`
3. Описание: "Анализ текстового корпуса"
4. Выбрать "Public"
5. Отметить "Add a README file"
6. Нажать "Create repository"

**Готово!** У вас есть репозиторий

---

## Загрузка файлов: Веб-интерфейс GitHub

**Самый простой способ (пока):**

1. В вашем репозитории нажать "Add file" → "Upload files"
2. Перетащить ваши файлы:
   - `main.py`
   - `file_utils.py`
   - `README.md`
3. Написать сообщение коммита: "Начальная структура проекта"
4. Нажать "Commit changes"

**Готово!** Ваш код на GitHub

**Позже:** Изучим командную строку git для продвинутого рабочего процесса

---

## Лучшие практики GitHub

**Сообщения коммита:**
- "Добавить функцию чтения CSV"
- "Исправить ошибку кодировки в file_utils"
- "Обновление"
- "Изменения"

**Структура репозитория:**
```
python-dh-project/
├── README.md          # Описание проекта
├── main.py            # Главная точка входа
├── file_utils.py      # Ваши модули
├── corpus/            # (Не загружайте большие текстовые файлы!)
└── .gitignore         # Сказать Git, что игнорировать
```

---

## GitHub для вашего проекта

**К концу курса ваш GitHub покажет:**

```
python-dh-project/
├── README.md              ← Описание проекта
├── main.py                ← Полный оркестратор
├── file_utils.py          ← CSV-функции (Неделя 11)
├── text_utils.py          ← Функции анализа (Неделя 12)
├── data/
│   └── metadata.csv       ← Пример метаданных
└── .gitignore
```